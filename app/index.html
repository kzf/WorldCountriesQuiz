<!doctype html>
<html class="no-js">
  <head>
    <meta charset="utf-8">
    <title>WorldCountriesQuiz</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <link rel="shortcut icon" href="/favicon.ico">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!-- build:css(.) styles/vendor.css -->
    <!-- bower:css -->
    <!-- endbower -->
    <!-- endbuild -->
    <!-- build:css(.tmp) styles/main.css -->
    <link rel="stylesheet" href="styles/main.css">
    <!-- endbuild -->
    <!-- build:js scripts/vendor/modernizr.js -->
    <script src="bower_components/modernizr/modernizr.js"></script>
    <!-- endbuild -->

  </head>
  <body>
    <!--[if lt IE 10]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->


    <!--<div class="container">
      <div class="header">
        <ul class="nav nav-pills pull-right">
          <li class="active"><a href="#">Home</a></li>
          <li><a href="#">About</a></li>
          <li><a href="#">Contact</a></li>
        </ul>
        <h3 class="text-muted">WorldCountriesQuiz</h3>
      </div>

      <div class="jumbotron">
        <h1>'Allo, 'Allo!</h1>
        <p class="lead">Always a pleasure scaffolding your apps.</p>
        <p><a class="btn btn-lg btn-success" href="#">Splendid! <span class="glyphicon glyphicon-ok"></span></a></p>
      </div>

      <div class="row marketing">
        <div class="col-lg-6">
          <h4>HTML5 Boilerplate</h4>
          <p>HTML5 Boilerplate is a professional front-end template for building fast, robust, and adaptable web apps or sites.</p>

          <h4>Sass</h4>
          <p>Sass is a mature, stable, and powerful professional grade CSS extension language.</p>


          <h4>Bootstrap</h4>
          <p>Sleek, intuitive, and powerful mobile first front-end framework for faster and easier web development.</p>

          <h4>Modernizr</h4>
          <p>Modernizr is an open-source JavaScript library that helps you build the next generation of HTML5 and CSS3-powered websites.</p>

        </div>
      </div>

      <div class="footer">
        <p><span class="glyphicon glyphicon-heart"></span> from the Yeoman team</p>
      </div>

    </div>-->

    <div class="container">
      <div class="header">
        <h1>World Countries Quiz</h1>
      </div>

      <div class="worldmap">
        <div class="worldmapSmall">
        </div>
      </div>
    </div>


    <!-- build:js(.) scripts/vendor.js -->
    <!-- bower:js -->
    <script src="bower_components/jquery/dist/jquery.js"></script>
    <script src="bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/affix.js"></script>
    <script src="bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/alert.js"></script>
    <script src="bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/button.js"></script>
    <script src="bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/carousel.js"></script>
    <script src="bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/collapse.js"></script>
    <script src="bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/dropdown.js"></script>
    <script src="bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/tab.js"></script>
    <script src="bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/transition.js"></script>
    <script src="bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/scrollspy.js"></script>
    <script src="bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/modal.js"></script>
    <script src="bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/tooltip.js"></script>
    <script src="bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/popover.js"></script>
    <!-- endbower -->
    <!-- endbuild -->

    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script>

    var WIDTH = 960,
        HEIGHT = 500;

    var projection = d3.geo.orthographic()
        .scale(250)
        .clipAngle(90);

    var canvas = d3.select(".worldmap").append("canvas")
        .attr("width", WIDTH)
        .attr("height", HEIGHT);

    var c = canvas.node().getContext("2d");

    var canvas2 = d3.select(".worldmapSmall").append("canvas")
        .attr("width", 140)
        .attr("height", 140);

    var c2 = canvas2.node().getContext("2d");

    var path = d3.geo.path()
        .projection(projection)
        .context(c);

    var path2 = d3.geo.path()
        .projection(projection)
        .context(c2);

    var title = d3.select("h1");

    queue()
        .defer(d3.json, "./data/world-110m.json")
        .defer(d3.tsv, "./data/world-country-names.tsv")
        .await(ready);

    function ready(error, world, names) {
      var globe = {type: "Sphere"},
          land = topojson.feature(world, world.objects.land),
          countries = topojson.feature(world, world.objects.countries).features,
          borders = topojson.mesh(world, world.objects.countries, function(a, b) { return a !== b; }),
          i = -1,
          n = countries.length;

      countries = countries.filter(function(d) {
        return names.some(function(n) {
          if (d.id == n.id) return d.name = n.name;
        });
      }).sort(function(a, b) {
        return a.name.localeCompare(b.name);
      });

    //   (function transition() {
    //     d3.transition()
    //         .duration(1250)
    //         .each("start", function() {
    //           title.text(countries[i = (i + 1) % n].name);
    //         })
    //         .tween("rotate", function() {
    //           var p = d3.geo.centroid(countries[i]),
    //               r = d3.interpolate(projection.rotate(), [-p[0], -p[1]]);
    //           return function(t) {
    //             projection.rotate(r(1));
    //             c.clearRect(0, 0, width, height);
    //             c.fillStyle = "#bbb", c.beginPath(), path(land), c.fill();
    //             c.fillStyle = "#f00", c.beginPath(), path(countries[i]), c.fill();
    //             c.strokeStyle = "#fff", c.lineWidth = .5, c.beginPath(), path(borders), c.stroke();
    //             c.strokeStyle = "#000", c.lineWidth = 2, c.beginPath(), path(globe), c.stroke();
    //           };
    //         })
    //       .transition()
    //         .each("end", transition);
    //   })();
    // }

      setInterval(function() {
        var country = Math.floor(Math.random()*n);
        title.text(countries[country].name);

        var p = d3.geo.centroid(countries[country]);

        projection.rotate([-p[0], -p[1]]);
        projection.scale(68);
        projection.translate([70, 70]);

        c2.clearRect(0, 0, 140, 140);
        c2.strokeStyle = "#000", c2.lineWidth = 2, c2.beginPath(), path2(globe), c2.stroke(), c2.fillStyle = "#fff", c2.fill();
        c2.fillStyle = "#bbb", c2.beginPath(), path2(land), c2.fill();
        c2.fillStyle = "#f00", c2.beginPath(), path2(countries[country]), c2.fill();
        c2.strokeStyle = "#fff", c2.lineWidth = .5, c2.beginPath(), path2(borders), c2.stroke();

        projection.translate([WIDTH/2, HEIGHT/2]);
        projection.scale(1);

        var b = path.bounds(countries[country]);
        var w1 = Math.abs(b[1][0]-b[0][0])/WIDTH;
        var w2 = Math.abs(b[1][1]-b[0][1])/HEIGHT;
        projection.scale(Math.min(1000, .45/(Math.max(w1, w2))));

        c.clearRect(0, 0, WIDTH, HEIGHT);
        c.fillStyle = "#bbb", c.beginPath(), path(land), c.fill();
        c.fillStyle = "#f00", c.beginPath(), path(countries[country]), c.fill();
        c.strokeStyle = "#fff", c.lineWidth = .5, c.beginPath(), path(borders), c.stroke();
        c.strokeStyle = "#000", c.lineWidth = 2, c.beginPath(), path(globe), c.stroke();

      }, 500);
    }

    </script>

    <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
    <script>
      (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
      function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
      e=o.createElement(i);r=o.getElementsByTagName(i)[0];
      e.src='//www.google-analytics.com/analytics.js';
      r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
      ga('create','UA-XXXXX-X');ga('send','pageview');
    </script>

        <!-- build:js({app,.tmp}) scripts/main.js -->
        <script src="scripts/main.js"></script>
        <!-- endbuild -->
</body>
</html>
